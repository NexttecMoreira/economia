<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Resumo - NextFlow</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="apple-touch-icon" href="logo.png">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="stylesheet" href="style.css?v=4">
  <script src="firebase-config.js?v=4"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
  <script src="subscription-middleware.js?v=4"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
</head>
<body class="resumo-bg">
  <div class="resumo-container">
    <!-- User Info Header -->
    <div class="user-info-header">
      <div class="user-info">
        <div class="user-avatar">
          <img src="logo.png" alt="NextFlow" style="width: 50px; height: 50px; border-radius: 100px;">
        </div>
        <div class="user-details">
          <span id="user-email" class="user-email">Carregando...</span>
          <span id="user-subscription" class="user-subscription">
            <span class="subscription-badge">Premium Ativo</span>
          </span>
        </div>
      </div>
      <div class="header-actions">
        <button id="admin-btn" class="btn-header-action" title="Painel Admin" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
          </svg>
        </button>
        <button id="manage-subscription-btn-new" class="btn-header-action" title="Gerenciar Assinatura">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M12 1v6m0 6v6m5.2-13.2l-4.2 4.2m0 6l4.2 4.2m6-12h-6m-6 0H1m13.2 5.2l-4.2-4.2m0 0L5.8 18.8"></path>
          </svg>
        </button>
        <button id="resumo-btn-sair-new" class="btn-header-action btn-logout" title="Sair">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4m7 14l5-5-5-5m5 5H9"></path>
          </svg>
        </button>
      </div>
    </div>

    <div style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; gap: 1rem;">
      <button id="resumo-btn-sair" class="resumo-btn-voltar">â† Sair</button>
      <button id="manage-subscription-btn" class="resumo-btn-gerenciar">âš™ï¸ Gerenciar Assinatura</button>
    </div>
    <header class="resumo-header">
      <h1 class="resumo-titulo">Resumo Financeiro</h1>
      <p class="resumo-subtitulo">VisÃ£o geral dos seus ganhos e gastos</p>
      
      <!-- Quick Actions -->
      <div class="quick-actions">
        <button id="btn-quick-add-income" class="btn-quick-action btn-quick-income">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Adicionar Ganho
        </button>
        <button id="btn-quick-add-expense" class="btn-quick-action btn-quick-expense">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Adicionar Gasto
        </button>
      </div>
      
      <div class="resumo-periodo">
        <button id="btn-periodo-dia" class="resumo-btn-periodo ativo">Dia</button>
        <button id="btn-periodo-mes" class="resumo-btn-periodo">MÃªs</button>
        <button id="btn-periodo-ano" class="resumo-btn-periodo">Ano</button>
      </div>
      <a href="datas.html" class="resumo-btn-calendario">Ver CalendÃ¡rio</a>
    </header>

    <section class="resumo-totais">
      <div class="resumo-card-ganhos">
        <div class="card-icon card-icon-income">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="1" x2="12" y2="23"></line>
            <polyline points="17 6 12 1 7 6"></polyline>
          </svg>
        </div>
        <h3 class="resumo-label-ganhos">Total Ganhos</h3>
        <p id="resumo-total-ganhos" class="resumo-valor-ganhos">R$ 0,00</p>
        <span id="income-variation" class="variation-indicator">â€”</span>
      </div>
      <div class="resumo-card-gastos">
        <div class="card-icon card-icon-expense">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="1" x2="12" y2="23"></line>
            <polyline points="7 18 12 23 17 18"></polyline>
          </svg>
        </div>
        <h3 class="resumo-label-gastos">Total Gastos</h3>
        <p id="resumo-total-gastos" class="resumo-valor-gastos">R$ 0,00</p>
        <span id="expense-variation" class="variation-indicator">â€”</span>
      </div>
      <div class="resumo-card-saldo">
        <div class="card-icon card-icon-balance">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
            <line x1="1" y1="10" x2="23" y2="10"></line>
          </svg>
        </div>
        <h3 class="resumo-label-saldo">Saldo</h3>
        <p id="resumo-total-saldo" class="resumo-valor-saldo">R$ 0,00</p>
        <span id="balance-variation" class="variation-indicator">â€”</span>
      </div>
    </section>

    <section class="resumo-grafico">
      <h2 class="resumo-grafico-titulo">Ganhos por Categoria</h2>
      <div class="resumo-grafico-wrapper">
        <canvas id="resumo-grafico-ganhos" class="resumo-canvas"></canvas>
        <div id="resumo-legenda-ganhos" class="resumo-legenda"></div>
      </div>
      <a href="ganhos.html" class="resumo-link resumo-link-ganhos">Gerenciar Ganhos</a>
    </section>

    <section class="resumo-grafico">
      <h2 class="resumo-grafico-titulo">Gastos por Categoria</h2>
      <div class="resumo-grafico-wrapper">
        <canvas id="resumo-grafico-gastos" class="resumo-canvas"></canvas>
        <div id="resumo-legenda-gastos" class="resumo-legenda"></div>
      </div>
      <a href="gastos.html" class="resumo-link resumo-link-gastos">Gerenciar Gastos</a>
    </section>
  </div>

  <!-- Modal de InstalaÃ§Ã£o PWA -->
  <div id="install-modal" class="install-modal">
    <div class="install-modal-content">
      <button class="install-modal-close" id="close-modal">&times;</button>
      <img src="logo.png" alt="NextFlow" style="width: 60px; height: 60px; border-radius: 12px; margin-bottom: 1rem;">
      <h2>ğŸ“± Instale o NextFlow</h2>
      <p style="margin-bottom: 1.5rem; color: #9CA3AF;">Adicione o app Ã  tela inicial do seu celular para acesso rÃ¡pido!</p>
      
      <div class="install-steps">
        <!-- iOS Safari -->
        <div class="install-step" id="ios-steps" style="display: none;">
          <h3>ğŸ“± iPhone/iPad (Safari)</h3>
          <ol>
            <li>Toque no botÃ£o <strong>Compartilhar</strong> <svg style="width: 16px; height: 16px; display: inline; vertical-align: middle;" viewBox="0 0 24 24" fill="currentColor"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg> (na parte inferior)</li>
            <li>Role para baixo e toque em <strong>"Adicionar Ã  Tela de InÃ­cio"</strong> ğŸ“²</li>
            <li>Toque em <strong>"Adicionar"</strong> no canto superior direito</li>
            <li>Pronto! O app aparecerÃ¡ na sua tela inicial ğŸ‰</li>
          </ol>
        </div>

        <!-- Android Chrome -->
        <div class="install-step" id="android-steps" style="display: none;">
          <h3>ğŸ¤– Android (Chrome)</h3>
          <ol>
            <li>Toque no menu <strong>â‹®</strong> (trÃªs pontos) no canto superior direito</li>
            <li>Selecione <strong>"Adicionar Ã  tela inicial"</strong> ou <strong>"Instalar app"</strong> ğŸ“²</li>
            <li>Toque em <strong>"Adicionar"</strong> ou <strong>"Instalar"</strong></li>
            <li>Pronto! O app aparecerÃ¡ na sua tela inicial ğŸ‰</li>
          </ol>
        </div>

        <!-- Desktop -->
        <div class="install-step" id="desktop-steps" style="display: none;">
          <h3>ğŸ’» Computador (Chrome/Edge)</h3>
          <ol>
            <li>Clique no Ã­cone <strong>âŠ•</strong> ou <strong>ğŸ–¥ï¸</strong> na barra de endereÃ§o</li>
            <li>Clique em <strong>"Instalar"</strong></li>
            <li>O app serÃ¡ instalado como um programa no seu computador ğŸ‰</li>
          </ol>
        </div>
      </div>

      <button class="install-modal-btn" id="got-it-btn">Entendi!</button>
      <label style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-top: 1rem; color: #9CA3AF; font-size: 0.9rem;">
        <input type="checkbox" id="dont-show-again" style="width: 16px; height: 16px;">
        NÃ£o mostrar hoje
      </label>
    </div>
  </div>

  <script src="script.js?v=4" defer></script>
</body>
</html>